services:
  dynamodb:
    build:
      context: .
      dockerfile: Dockerfile.dynamodb
    hostname: dynamodb-local
    container_name: dynamodb-local
    command: -jar DynamoDBLocal.jar -sharedDb -dbPath /home/dynamodblocal/data/
    ports:
      - "8041:8000"
    volumes:
      - dynamodb-volume:/home/dynamodblocal/data
    networks:
      - local-serverless-network

  api:
    build:
      context: .
      dockerfile: Dockerfile.sam
    command: bash -c "sam build && sam local start-api --warm-containers EAGER --docker-network rocketnotes_local-serverless-network"
    platform: linux/amd64
    ports:
      - "3000:3000"

  webapp:
    build: webapp/.
    container_name: rocketnotes-webapp
    platform: linux/amd64
    ports:
      - "3001:3001"

volumes:
  dynamodb-volume:
   driver: local

networks:
   local-serverless-network:
     driver: "bridge"