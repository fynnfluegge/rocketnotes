services:
  dynamodb:
    build:
      context: .
      dockerfile: Dockerfile.dynamodb
    hostname: dynamodb-local
    container_name: dynamodb-local
    command: -jar DynamoDBLocal.jar -sharedDb -dbPath /home/dynamodblocal/data/
    ports:
      - "8041:8000"
    volumes:
      - dynamodb-volume:/home/dynamodblocal/data
    networks:
      - local-serverless-network

  api:
    build:
      context: .
      dockerfile: Dockerfile.sam
    command: bash -c "sam build && sam local start-api --host 0.0.0.0 --container-host host.docker.internal --port 3002 --docker-volume-basedir /var/task/.aws-sam/build --debug"
      # NEEDS TO BE ADDED TO command once segmentataion fault is fixed: --skip-pull-image --warm-containers EAGER --docker-network rocketnotes_local-serverless-network
    container_name: rocketnotes-api
    mem_limit: "1g"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    platform: linux/amd64
    ports:
      - "3002:3002"

  webapp:
    build: webapp/.
    container_name: rocketnotes-webapp
    platform: linux/amd64
    ports:
      - "3001:3001"

volumes:
  dynamodb-volume:
   driver: local

networks:
   local-serverless-network:
     driver: "bridge"